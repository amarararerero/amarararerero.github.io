<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn 0.2s ease-out forwards; }
    .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #4B5563; }
  </style>
</head>
<body class="bg-gray-950 text-gray-200 min-h-screen font-sans antialiased pb-32">

  <div class="max-w-5xl mx-auto p-4 md:p-8">
    
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 border-b border-gray-800 pb-6">
      <div>
        <h1 class="text-3xl font-extrabold tracking-tight text-white">Daily Sales Calculation</h1>
        <p class="text-gray-500 mt-1 text-sm">Select a kitchen and enter tally strings (e.g., 1,2,3)</p>
      </div>
      
      <div class="flex p-1 bg-gray-900 rounded-lg border border-gray-800 shadow-inner w-full md:w-auto">
        <button id="btn-k1" class="flex-1 md:flex-none px-6 py-2.5 rounded-md bg-gray-800 text-white font-medium shadow-sm transition-all duration-200" onclick="setKitchen(1)">
          Kitchen 1
        </button>
        <button id="btn-k2" class="flex-1 md:flex-none px-6 py-2.5 rounded-md text-gray-500 font-medium hover:text-gray-300 transition-all duration-200" onclick="setKitchen(2)">
          Kitchen 2
        </button>
      </div>
    </div>

    <div class="mb-12">
      <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Product Grid</h2>
      <div id="product-grid" class="grid grid-cols-3 gap-3 md:gap-4">
        </div>
    </div>

    <div class="bg-gray-900 rounded-xl border border-gray-800 overflow-hidden shadow-2xl">
      <div class="p-5 border-b border-gray-800 flex justify-between items-center bg-gray-900/50">
        <h2 class="text-lg font-bold text-white">Live Calculation Summary</h2>
        <div class="text-right">
          <p class="text-xs text-gray-500 uppercase tracking-wider font-semibold">Must Get Sales</p>
          <p id="grand-total" class="text-3xl font-black text-teal-400">RM 0.00</p>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm whitespace-nowrap">
          <thead class="bg-gray-950/50 text-gray-400">
            <tr>
              <th class="px-6 py-4 font-semibold">Product</th>
              <th class="px-6 py-4 font-semibold text-center w-32">Kitchen 1</th>
              <th class="px-6 py-4 font-semibold text-center w-32">Kitchen 2</th>
              <th class="px-6 py-4 font-semibold text-center text-teal-500">Total Qty</th>
              <th class="px-6 py-4 font-semibold text-right">Total Sales</th>
            </tr>
          </thead>
          <tbody id="calculation-body" class="divide-y divide-gray-800">
            </tbody>
        </table>
      </div>
    </div>

  </div>

  <div id="quantity-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex justify-center items-center fade-in z-50 p-4">
    <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700 slide-up">
      <div class="flex justify-between items-center mb-6">
        <h2 id="modal-title" class="text-xl font-bold text-white">Enter Records</h2>
        <button onclick="closeModal('quantity-modal')" class="text-gray-500 hover:text-white transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      </div>
      
      <div class="mb-8">
        <label class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2" id="modal-kitchen-label">Kitchen 1</label>
        <input type="text" id="qty-input" autocomplete="off" class="w-full bg-gray-950 border border-gray-700 rounded-lg p-4 text-white text-2xl font-bold text-center focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-all tracking-wider" placeholder="e.g. 1, 2, 3">
        <p class="text-center text-gray-500 text-xs mt-3">Separate numbers with commas or spaces.</p>
      </div>
      
      <div class="grid grid-cols-2 gap-3">
        <button class="py-3 rounded-lg text-gray-400 font-semibold bg-gray-800 hover:bg-gray-700 transition-colors" onclick="closeModal('quantity-modal')">Cancel</button>
        <button class="py-3 bg-teal-600 hover:bg-teal-500 text-white rounded-lg font-bold shadow-lg shadow-teal-900/20 transition-all" onclick="saveQuantity()">Confirm</button>
      </div>
    </div>
  </div>

  <div id="new-product-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex justify-center items-center fade-in z-50 p-4">
    <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl w-full max-w-sm border border-gray-700 slide-up">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-white">Add New Item</h2>
        <button onclick="closeModal('new-product-modal')" class="text-gray-500 hover:text-white transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      </div>
      
      <div class="mb-8">
        <label class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Item Name</label>
        <input type="text" id="new-product-name" autocomplete="off" class="w-full bg-gray-950 border border-gray-700 rounded-lg p-3 text-white text-lg focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all" placeholder="e.g. Extra Cheese">
      </div>
      
      <div class="grid grid-cols-2 gap-3">
        <button class="py-3 rounded-lg text-gray-400 font-semibold bg-gray-800 hover:bg-gray-700 transition-colors" onclick="closeModal('new-product-modal')">Cancel</button>
        <button class="py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-bold shadow-lg shadow-purple-900/20 transition-all" onclick="addNewProduct()">Create</button>
      </div>
    </div>
  </div>

  <script>
    // Initial Menu Data
    const rawMenuData = [
      { name: "J Ayam", price: 12.0, color: "#99485A" },
      { name: "J Daging", price: 12.0, color: "#99485A" },
      { name: "", price: 0, color: "#000000" },
      { name: "J Ustaz Ayam", price: 15.0, color: "#7A5A9C" },
      { name: "J Ustaz Daging", price: 15.0, color: "#7A5A9C" },
      { name: "J Ustaz Kambing", price: 29.0, color: "#7A5A9C" },
      { name: "J Grill Ayam", price: 14.0, color: "#A68C3D" },
      { name: "J Grill Daging", price: 14.0, color: "#A68C3D" },
      { name: "J Grill Kambing", price: 26.0, color: "#A68C3D" },
      { name: "J Oblong Ayam", price: 13.0, color: "#B97A59" },
      { name: "J Oblong Daging", price: 13.0, color: "#B97A59" },
      { name: "J Oblong Kambing", price: 16.0, color: "#B97A59" },
      { name: "J JuJumbo", price: 14.0, color: "#5A9C87" },
      { name: "J MeatBall", price: 14.0, color: "#9C5B5B" },
      { name: "J Ayam Goreng", price: 14.0, color: "#9C5B5B" },
      { name: "J Special Ayam", price: 15.0, color: "#B8860B" },
      { name: "J Special Daging", price: 15.0, color: "#B8860B" },
      { name: "", price: 0, color: "#000000" },
      { name: "J Tuna", price: 14.0, color: "#7865A8" },
      { name: "J Seafood Crab", price: 14.0, color: "#7865A8" },
      { name: "J Sardin", price: 12.0, color: "#7865A8" },
      { name: "J BMT", price: 18.0, color: "#9C5B5B" },
      { name: "J Triple Cheese Ayam", price: 23.0, color: "#5A9C87" },
      { name: "J Triple Cheese Daging", price: 23.0, color: "#5A9C87" },
    ];

    // Initialize Products Array
    let productsData = rawMenuData.map((item, index) => ({
      ...item,
      uid: `prod_${index}`,
      isCustom: false
    }));

    // State
    let currentKitchen = 1;
    let records = {
      kitchen1: {}, 
      kitchen2: {}
    };
    let activeProductId = null;

    // DOM Elements
    const grid = document.getElementById('product-grid');
    const tableBody = document.getElementById('calculation-body');
    const grandTotalEl = document.getElementById('grand-total');
    
    // Modal Elements
    const qtyModal = document.getElementById('quantity-modal');
    const qtyInput = document.getElementById('qty-input');
    const modalTitle = document.getElementById('modal-title');
    const modalKitchenLabel = document.getElementById('modal-kitchen-label');
    
    const newProductModal = document.getElementById('new-product-modal');
    const newProductNameInput = document.getElementById('new-product-name');

    // Helper: Parse Sum
    function parseSum(inputStr) {
      if (!inputStr) return 0;
      const parts = inputStr.toString().trim().split(/[\s,\+]+/);
      return parts.reduce((sum, part) => {
        const val = parseInt(part);
        return sum + (isNaN(val) ? 0 : val);
      }, 0);
    }

    function init() {
      // Initialize records for base products
      productsData.forEach(p => {
        records.kitchen1[p.uid] = "";
        records.kitchen2[p.uid] = "";
      });
      renderUI();
    }

    function renderUI() {
      renderGrid();
      renderTable();
    }

    // Renders the Grid
    function renderGrid() {
      grid.innerHTML = '';
      
      // 1. Render All Existing Products
      productsData.forEach(product => {
        if (!product.name) {
          // Spacer for layout
          const spacer = document.createElement('div');
          spacer.className = "invisible min-h-[110px]";
          grid.appendChild(spacer);
          return;
        }

        const rawData = records[`kitchen${currentKitchen}`][product.uid];
        const currentSum = parseSum(rawData);
        const hasQty = currentSum > 0;
        
        const btn = document.createElement('button');
        
        // Custom styling for dynamically added products
        const borderClass = product.isCustom 
          ? 'border-dashed border-2 border-gray-600 bg-gray-900/50' 
          : 'border border-black/20';

        const nameColorClass = product.isCustom ? 'text-gray-300' : 'text-white';
        const priceDisplay = product.price > 0 
          ? `RM ${product.price.toFixed(2)}` 
          : `<span class="italic opacity-50">Qty Only</span>`;

        btn.className = `relative rounded-xl shadow-md flex flex-col items-start p-3 md:p-4 transition-all duration-200 hover:-translate-y-1 hover:shadow-xl overflow-hidden group text-left min-h-[110px] ${borderClass}`;
        
        if (!product.isCustom) {
           btn.style.backgroundColor = product.color;
        }

        btn.onclick = () => openQtyModal(product);
        
        btn.innerHTML = `
          <div class="absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors z-0"></div>
          
          <div class="relative z-10 flex flex-col h-full w-full justify-between">
            <div>
              <div class="font-bold text-sm md:text-base leading-tight w-full drop-shadow-md ${nameColorClass}">${product.name}</div>
              <div class="text-white/80 text-xs md:text-sm mt-0.5 font-medium drop-shadow-md">${priceDisplay}</div>
            </div>
            
            <div class="mt-3">
              ${hasQty 
                ? `<span class="bg-white text-gray-900 text-xs font-bold px-2 py-0.5 rounded-full shadow-sm inline-flex items-center gap-1.5 border border-gray-200">
                     <span class="w-1.5 h-1.5 rounded-full" style="background-color: ${product.color || '#9CA3AF'}"></span> Qty: ${currentSum}
                   </span>` 
                : `<span class="bg-black/40 text-white/80 text-xs font-medium px-2 py-0.5 rounded-full inline-flex items-center gap-1.5 border border-white/10">
                     <span class="w-1.5 h-1.5 rounded-full bg-gray-400"></span> Qty: 0
                   </span>`
              }
            </div>
          </div>
        `;
        grid.appendChild(btn);
      });

      // 2. Render the "Add New Product" Button at the end
      const addBtn = document.createElement('button');
      addBtn.className = "rounded-xl border-2 border-dashed border-gray-600 flex flex-col items-center justify-center p-4 text-gray-500 hover:text-white hover:border-gray-400 hover:bg-gray-800 transition-all min-h-[110px]";
      addBtn.onclick = openNewProductModal;
      addBtn.innerHTML = `
        <svg class="w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span class="font-bold text-sm">Add Custom Item</span>
      `;
      grid.appendChild(addBtn);
    }

    // Renders the Calculation Table
    function renderTable() {
      tableBody.innerHTML = '';
      
      let grandTotal = 0;
      let totalK1Items = 0;
      let totalK2Items = 0;

      productsData.forEach(product => {
        if (!product.name) return; // Skip blank spacers in table

        const rawK1 = records.kitchen1[product.uid];
        const rawK2 = records.kitchen2[product.uid];
        
        const k1Qty = parseSum(rawK1);
        const k2Qty = parseSum(rawK2);
        const totalQty = k1Qty + k2Qty;
        
        // Summing up overall items for each kitchen
        totalK1Items += k1Qty;
        totalK2Items += k2Qty;
        
        const totalSales = totalQty * product.price;
        grandTotal += totalSales;

        if (totalQty > 0) {
          const row = document.createElement('tr');
          row.className = "hover:bg-gray-800/50 transition-colors";
          
          row.innerHTML = `
            <td class="px-6 py-4 font-medium" style="color: ${product.isCustom ? '#9CA3AF' : product.color}">
              ${product.name} ${product.isCustom ? '<span class="text-xs ml-2 border border-gray-700 rounded px-1 text-gray-500">Custom</span>' : ''}
            </td>
            <td class="px-6 py-4 text-center">
              <div class="text-gray-300 font-bold">${k1Qty || '-'}</div>
              ${rawK1 ? `<div class="text-[10px] text-gray-500 mt-1 max-w-[100px] mx-auto truncate" title="${rawK1}">${rawK1}</div>` : ''}
            </td>
            <td class="px-6 py-4 text-center">
              <div class="text-gray-300 font-bold">${k2Qty || '-'}</div>
              ${rawK2 ? `<div class="text-[10px] text-gray-500 mt-1 max-w-[100px] mx-auto truncate" title="${rawK2}">${rawK2}</div>` : ''}
            </td>
            <td class="px-6 py-4 text-center font-black text-teal-400 text-lg">${totalQty}</td>
            <td class="px-6 py-4 text-right font-medium text-gray-200">
              ${product.price > 0 ? `RM ${totalSales.toFixed(2)}` : '-'}
            </td>
          `;
          tableBody.appendChild(row);
        }
      });

      // Append Total Items Row at the bottom of the table
      if (totalK1Items > 0 || totalK2Items > 0) {
        const footerRow = document.createElement('tr');
        footerRow.className = "bg-gray-900/80 border-t-2 border-gray-700";
        footerRow.innerHTML = `
          <td class="px-6 py-4 font-bold text-gray-400 uppercase tracking-wider text-xs">Total Items Sold</td>
          <td class="px-6 py-4 text-center font-bold text-white text-lg">${totalK1Items}</td>
          <td class="px-6 py-4 text-center font-bold text-white text-lg">${totalK2Items}</td>
          <td class="px-6 py-4 text-center font-black text-teal-400 text-xl">${totalK1Items + totalK2Items}</td>
          <td class="px-6 py-4"></td>
        `;
        tableBody.appendChild(footerRow);
      }

      grandTotalEl.innerText = `RM ${grandTotal.toFixed(2)}`;
    }

    // --- Interaction Functions ---

    function setKitchen(k) {
      currentKitchen = k;
      document.getElementById('btn-k1').className = k === 1 
        ? 'flex-1 md:flex-none px-6 py-2.5 rounded-md bg-gray-800 text-white font-medium shadow-sm transition-all duration-200' 
        : 'flex-1 md:flex-none px-6 py-2.5 rounded-md text-gray-500 font-medium hover:text-gray-300 transition-all duration-200';
      document.getElementById('btn-k2').className = k === 2 
        ? 'flex-1 md:flex-none px-6 py-2.5 rounded-md bg-gray-800 text-white font-medium shadow-sm transition-all duration-200' 
        : 'flex-1 md:flex-none px-6 py-2.5 rounded-md text-gray-500 font-medium hover:text-gray-300 transition-all duration-200';
      renderGrid();
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
      activeProductId = null;
    }

    // 1. Quantity Modal Logic
    function openQtyModal(product) {
      activeProductId = product.uid;
      modalTitle.innerText = product.name;
      modalKitchenLabel.innerText = `Recording for Kitchen ${currentKitchen}`;
      qtyInput.value = records[`kitchen${currentKitchen}`][product.uid] || '';
      qtyModal.classList.remove('hidden');
      setTimeout(() => qtyInput.focus(), 50);
    }

    function saveQuantity() {
      const rawStr = qtyInput.value.trim();
      records[`kitchen${currentKitchen}`][activeProductId] = rawStr;
      closeModal('quantity-modal');
      renderUI();
    }

    // 2. New Product Modal Logic
    function openNewProductModal() {
      newProductNameInput.value = '';
      newProductModal.classList.remove('hidden');
      setTimeout(() => newProductNameInput.focus(), 50);
    }

    function addNewProduct() {
      const name = newProductNameInput.value.trim();
      if (!name) return;

      const newUid = `custom_${Date.now()}`; // Unique ID based on timestamp
      
      const newProduct = {
        name: name,
        price: 0, // As requested
        color: "#4B5563",
        uid: newUid,
        isCustom: true
      };

      // Add to data structures
      productsData.push(newProduct);
      records.kitchen1[newUid] = "";
      records.kitchen2[newUid] = "";

      closeModal('new-product-modal');
      renderUI();
    }

    // Keyboard support
    qtyInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') saveQuantity();
    });
    
    newProductNameInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') addNewProduct();
    });

    init();
  </script>
</body>
</html>
